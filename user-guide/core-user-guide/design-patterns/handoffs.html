<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="../../../" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Handoffs | AutoGen</title>
<meta content="Handoffs | AutoGen" property="og:title"/>
<meta content="Handoffs | AutoGen" name="twitter:title"/>
<link href="../../../_static/pygments.css?v=3d3fbe02" rel="stylesheet" type="text/css"/>
<link href="../../../_static/theme.css?v=42baaae4" rel="stylesheet" type="text/css"/>
<link href="../../../_static/graphviz.css?v=4ae1632d" rel="stylesheet" type="text/css"/>
<link href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/sphinx-design.min.css?v=95c83b7e" rel="stylesheet" type="text/css"/>
<link href="../../../_static/custom.css?v=ebe0eec8" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet" type="text/css"/>
<link href="../../../_static/awesome-sphinx-design.css?v=15e0fffa" rel="stylesheet" type="text/css"/>
<link href="/autogen/dev/user-guide/core-user-guide/design-patterns/handoffs.html" rel="canonical"/>
<link href="../../../_static/favicon-512x512.png" rel="icon"/>
<link href="../../../search.html" rel="search" title="Search"/>
<link href="../../../genindex.html" rel="index" title="Index"/>
<link href="mixture-of-agents.html" rel="next" title="Mixture of Agents"/>
<link href="group-chat.html" rel="prev" title="Group Chat"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
     
      function closeAnnouncement() {
          var announcementBar = document.getElementById('announcementBar');
          if (announcementBar) {
              announcementBar.style.animation = 'fadeOut 0.5s ease forwards';
              setTimeout(() => {
                  announcementBar.remove();
              }, 500);
          }
      }
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page">
<div class="announcementbar" id="announcementBar">
<div class="announcementbar-content">
<div class="announcementbar-message"><span class="fa-solid fa-triangle-exclamation"></span> AutoGen v0.4 is a work in progress. Go <a href="https://microsoft.github.io/autogen/0.2/">here</a> to continue using v0.2 documentation.</div>
<button class="announcement-close-button" onclick="closeAnnouncement()">
<i class="fas fa-times"></i>
</button>
</div>
</div>
<a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../../../index.html">
<img alt="Logo" class="mr-2 dark:invert" height="24" src="../../../_static/logo.svg" width="24"/><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">AutoGen</span>
</a><nav class="flex items-center space-x-6 text-sm font-medium">
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="/index.html">Docs</a>
</nav></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../../../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">âŒ˜</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<a href="https://twitter.com/pyautogen" rel="noopener nofollow" title="Visit Twitter">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="22px" style="margin-top:-2px;display:inline" viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</div>
</a>
<a href="https://github.com/microsoft/agnext" rel="noopener nofollow" title="Visit GitHub">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="22px" style="margin-top:-2px;display:inline" viewbox="0 0 45 44" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M22.477.927C10.485.927.76 10.65.76 22.647c0 9.596 6.223 17.736 14.853 20.608 1.087.2 1.483-.47 1.483-1.047 0-.516-.019-1.881-.03-3.693-6.04 1.312-7.315-2.912-7.315-2.912-.988-2.51-2.412-3.178-2.412-3.178-1.972-1.346.149-1.32.149-1.32 2.18.154 3.327 2.24 3.327 2.24 1.937 3.318 5.084 2.36 6.321 1.803.197-1.403.759-2.36 1.379-2.903-4.823-.548-9.894-2.412-9.894-10.734 0-2.37.847-4.31 2.236-5.828-.224-.55-.969-2.759.214-5.748 0 0 1.822-.584 5.972 2.226 1.732-.482 3.59-.722 5.437-.732 1.845.01 3.703.25 5.437.732 4.147-2.81 5.967-2.226 5.967-2.226 1.185 2.99.44 5.198.217 5.748 1.392 1.517 2.232 3.457 2.232 5.828 0 8.344-5.078 10.18-9.916 10.717.779.67 1.474 1.996 1.474 4.021 0 2.904-.027 5.247-.027 5.96 0 .58.392 1.256 1.493 1.044C37.981 40.375 44.2 32.24 44.2 22.647c0-11.996-9.726-21.72-21.722-21.72" fill="currentColor" fill-rule="evenodd"></path></svg>
</div>
</a>
<a href="/packages" rel="noopener nofollow" title="Visit Packages">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="none" height="20" viewbox="0 0 118 105" width="22" xmlns="http://www.w3.org/2000/svg"><path d="M17.6645 40.4581L34.2565 46.4975L51.0948 40.3685L34.5029 34.329L17.6645 40.4581ZM34.329 26.8229L50.922 32.8623L67.7593 26.7333L51.1674 20.6938L34.329 26.8229Z" fill="#F7F7F4" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M34.329 26.8229L50.922 32.8624V52.3631L34.329 46.3247V26.8229Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M1 66.2116L17.592 72.2521L34.4303 66.1231L17.8373 60.0836L1 66.2116Z" fill="#F7F7F4" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M1 66.2117L17.592 72.2522V91.753L1 85.7146V66.2117Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M1 38.4783L17.592 44.5189L34.4303 38.3898L17.8373 32.3503L1 38.4783Z" fill="#F7F7F4" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M17.5919 44.5189V64.0196L34.4303 57.8916V38.3898L17.5919 44.5189Z" fill="white" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M1 38.4783L17.592 44.5189V64.0196L1 57.9812V38.4783Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M17.6634 72.2725L34.2564 78.3119V97.8137L17.6645 91.7743L17.6634 72.2725Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M17.6634 52.5775L34.2564 58.617L51.0948 52.4879L34.5028 46.4495L17.6634 52.5775Z" fill="#F7F7F4" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M17.6634 52.5775L34.2564 58.617V78.1188L17.6645 72.0794L17.6634 52.5775Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M100.917 66.1913V85.6932L117.754 79.5652V60.0634L100.917 66.1913Z" fill="white" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M84.251 72.2521V91.7529L101.089 85.6249V66.123L84.251 72.2521Z" fill="#FFD242" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M98.0377 77.0062C98.0378 77.4582 97.9542 77.9362 97.7917 78.413C97.6292 78.8897 97.391 79.3559 97.0907 79.7848C96.7904 80.2137 96.4338 80.5969 96.0414 80.9127C95.6489 81.2284 95.2283 81.4704 94.8036 81.6249C93.9463 81.9367 93.1241 81.8734 92.5178 81.4489C91.9116 81.0245 91.5708 80.2736 91.5705 79.3614C91.5703 78.9095 91.6539 78.4316 91.8163 77.9549C91.9787 77.4782 92.2168 77.0121 92.517 76.5832C92.8172 76.1543 93.1737 75.771 93.566 75.4552C93.9583 75.1394 94.3789 74.8973 94.8036 74.7428C95.2283 74.5882 95.6488 74.5241 96.0412 74.5542C96.4336 74.5844 96.7901 74.7081 97.0904 74.9184C97.3908 75.1287 97.629 75.4214 97.7915 75.7798C97.9541 76.1382 98.0377 76.5543 98.0377 77.0062Z" fill="white"></path><path d="M67.5865 78.3119V97.8137L84.4249 91.6847V72.1829L67.5865 78.3119Z" fill="#FFD242" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M50.922 84.3717V103.873L67.7593 97.7444V78.2437L50.922 84.3717Z" fill="white" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M34.329 78.3322L50.922 84.3716V103.873L34.329 97.834V78.3322Z" fill="#EFEEEA" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M100.917 46.4975V65.9983L117.754 59.8703V40.3685L100.917 46.4975Z" fill="#FFD242" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M84.3235 20.7632L100.917 26.8026L117.754 20.6736L101.162 14.6341L84.3235 20.7632Z" fill="#FFC91D" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M100.917 26.8026V46.3034L117.754 40.1754V20.6736L100.917 26.8026ZM84.251 52.5572V72.058L101.089 65.93V46.4282L84.251 52.5572Z" fill="#FFD242" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M84.251 32.8624V52.3631L101.089 46.2351V26.7333L84.251 32.8624Z" fill="#3775A9" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M67.6591 7.12799L84.251 13.1674L101.089 7.03839L84.4974 1L67.6591 7.12799Z" fill="#2F6491" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M84.251 13.1664V32.6682L101.089 26.5402V7.03839L84.251 13.1664Z" fill="#3775A9" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M67.5865 58.617V78.1188L84.4249 71.9898V52.4879L67.5865 58.617Z" fill="#FFD242" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M67.5865 38.9221V58.4239L84.4249 52.2948V32.793L67.5865 38.9221ZM50.922 64.6767V84.1785L67.7593 78.0495V58.5487L50.922 64.6767Z" fill="#3775A9" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M34.329 58.6383L50.922 64.6767V84.1786L34.329 78.1391V58.6383ZM34.329 38.9424L50.922 44.9818L67.7593 38.8538L51.1674 32.8144L34.329 38.9424Z" fill="#2F6491" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M50.922 44.9818V64.4836L67.7593 58.3546V38.8538L50.922 44.9818Z" fill="#3775A9" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M34.329 38.9423L50.922 44.9818V64.4836L34.329 58.4442V38.9423ZM50.9946 13.1877L67.5865 19.2272L84.4249 13.0981L67.8319 7.05972L50.9946 13.1877Z" fill="#2F6491" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M67.5865 19.2272V38.729L84.4249 32.5999V13.0981L67.5865 19.2272Z" fill="#3775A9" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M50.9946 13.1877L67.5865 19.2272V38.729L50.9946 32.6895V13.1877Z" fill="#2F6491" stroke="#CCCCCC" stroke-linejoin="bevel" stroke-width="0.378666"></path><path d="M77.1065 25.4906C77.1066 25.9426 77.023 26.4206 76.8605 26.8974C76.6981 27.3741 76.4598 27.8403 76.1595 28.2692C75.8592 28.6981 75.5026 29.0813 75.1102 29.3971C74.7177 29.7128 74.2971 29.9548 73.8724 30.1093C73.4477 30.2639 73.0271 30.3279 72.6347 30.2978C72.2424 30.2677 71.8858 30.1439 71.5855 29.9336C71.2852 29.7233 71.0469 29.4306 70.8844 29.0722C70.7219 28.7138 70.6382 28.2967 70.6382 27.8448C70.6381 27.3928 70.7217 26.9148 70.8842 26.438C71.0467 25.9613 71.2849 25.4951 71.5853 25.0662C71.8856 24.6373 72.2422 24.254 72.6346 23.9383C73.027 23.6226 73.4476 23.3806 73.8724 23.2261C74.2971 23.0715 74.7176 23.0074 75.11 23.0376C75.5024 23.0677 75.8589 23.1915 76.1593 23.4018C76.4596 23.612 76.6978 23.9047 76.8603 24.2632C77.0229 24.6216 77.1065 25.0387 77.1065 25.4906Z" fill="white"></path></svg>
</div>
</a>
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../../../index.html">
<img alt="Logo" class="mr-2 dark:invert" height="16" src="../../../_static/logo.svg" width="16"/><span class="font-bold text-clip whitespace-nowrap">AutoGen</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="flex md:hidden flex-col font-medium mt-4">
<a href="/index.html">Docs</a>
</nav><nav class="table w-full min-w-full my-6 lg:my-8">
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../agentchat-user-guide/index.html">AgentChat<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../../agentchat-user-guide/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../agentchat-user-guide/quickstart.html">Quickstart</a></li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../agentchat-user-guide/tutorial/index.html">Tutorial<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/models.html">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/agents.html">Agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/teams.html">Teams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/selector-group-chat.html">Selector Group Chat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/swarm.html">Swarm</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/termination.html">Termination</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/termination.html#autogen-provides-several-built-in-termination-conditions">AutoGen provides several built-in termination conditions:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/tutorial/custom-agents.html">Custom Agents</a></li>
</ul>
</li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../agentchat-user-guide/examples/index.html">Examples<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/examples/travel-planning.html">Travel Planning</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/examples/company-research.html">Company Research</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../agentchat-user-guide/examples/literature-review.html">Literature Review</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../index.html">Core<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../quickstart.html">Quick Start</a></li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../core-concepts/index.html">Core Concepts<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/agent-and-multi-agent-application.html">Agent and Multi-Agent Applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/architecture.html">Agent Runtime Environments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/api-layers.html">API Layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/application-stack.html">Application Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/agent-identity-and-lifecycle.html">Agent Identity and Lifecycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../core-concepts/topic-and-subscription.html">Topic and Subscription</a></li>
</ul>
</li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../framework/index.html">Framework Guide<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../framework/agent-and-agent-runtime.html">Agent and Agent Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/message-and-communication.html">Message and Communication</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/model-clients.html">Model Clients</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/tools.html">Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/logging.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/telemetry.html">Open Telemetry</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/command-line-code-executors.html">Command Line Code Executors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/distributed-agent-runtime.html">Distributed Agent Runtime</a></li>
<li class="toctree-l3"><a class="reference internal" href="../framework/distributed-agent-runtime.html#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="index.html">Multi-Agent Design Patterns<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="group-chat.html">Group Chat</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Handoffs</a></li>
<li class="toctree-l3"><a class="reference internal" href="mixture-of-agents.html">Mixture of Agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="multi-agent-debate.html">Multi-Agent Debate</a></li>
<li class="toctree-l3"><a class="reference internal" href="reflection.html">Reflection</a></li>
</ul>
</li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../cookbook/index.html">Cookbook<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../cookbook/azure-openai-with-aad-auth.html">Azure OpenAI with AAD Auth</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/termination-with-intervention.html">Termination using Intervention Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/tool-use-with-intervention.html">User Approval for Tool Execution using Intervention Handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/extracting-results-with-an-agent.html">Extracting Results with an Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/openai-assistant-agent.html">OpenAI Assistant Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/langgraph-agent.html">Using LangGraph-Backed Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/llamaindex-agent.html">Using LlamaIndex-Backed Agent</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/local-llms-ollama-litellm.html">Local LLMs with LiteLLM &amp; Ollama</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/instrumenting.html">Instrumentating your code locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/topic-subscription-scenarios.html">Topic and Subscription Example Scenarios</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cookbook/structured-output-agent.html">Structured output using GPT-4o models</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../faqs.html">FAQs</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../extensions-user-guide/index.html">Extensions<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../../extensions-user-guide/azure-container-code-executor.html">ACA Dynamic Sessions Code Executor</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../packages/index.html">Packages</a></li>
</ul>
<ul>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../../reference/index.html">API Reference<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../../reference/python/autogen_agentchat/autogen_agentchat.html">autogen_agentchat<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.agents.html">autogen_agentchat.agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.base.html">autogen_agentchat.base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.logging.html">autogen_agentchat.logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.task.html">autogen_agentchat.task</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.teams.html">autogen_agentchat.teams</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_agentchat/autogen_agentchat.messages.html">autogen_agentchat.messages</a></li>
</ul>
</li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../../reference/python/autogen_core/autogen_core.html">autogen_core<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_core/autogen_core.application.html">autogen_core.application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_core/autogen_core.base.html">autogen_core.base</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_core/autogen_core.components.html">autogen_core.components</a></li>
</ul>
</li>
<li class="toctree-l2" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../../../reference/python/autogen_ext/autogen_ext.html">autogen_ext<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_ext/autogen_ext.agents.html">autogen_ext.agents</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_ext/autogen_ext.code_executors.html">autogen_ext.code_executors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_ext/autogen_ext.models.html">autogen_ext.models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../reference/python/autogen_ext/autogen_ext.tools.html">autogen_ext.tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../../../index.html">
<span class="hidden md:inline">AutoGen</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="../index.html">Core</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="index.html">Multi-Agent Design Patterns</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Handoffs</span>
</nav>
<div id="content" role="main">
<section id="handoffs">
<h1>Handoffs<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#handoffs"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>Handoff is a multi-agent design pattern introduced by OpenAI in an experimental project called <a class="reference external" href="https://github.com/openai/swarm" rel="nofollow noopener">Swarm<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a>.
The key idea is to let agent delegate tasks to other agents using a special tool call.</p>
<p>We can use the AutoGen Core API to implement the handoff pattern using event-driven agents.
Using AutoGen (v0.4+) provides the following advantages over the OpenAI implementation and the previous version (v0.2):</p>
<ol class="arabic simple">
<li><p>It can scale to distributed environment by using distributed agent runtime.</p></li>
<li><p>It affords the flexibility of bringing your own agent implementation.</p></li>
<li><p>The natively async API makes it easy to integrate with UI and other systems.</p></li>
</ol>
<p>This notebook demonstrates a simple implementation of the handoff pattern.
It is recommended to read <a class="reference internal" href="../core-concepts/topic-and-subscription.html"><span class="std std-doc">Topics and Subscriptions</span></a>
to understand the basic concepts of pub-sub and event-driven agents.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are currently working on a high-level API for the handoff pattern in <a class="reference internal" href="../../agentchat-user-guide/index.html"><span class="std std-doc">AgentChat</span></a> so you can get started
much more quickly.</p>
</div>
<section id="scenario">
<h2>Scenario<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#scenario" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#scenario'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>This scenario is modified based on the <a class="reference external" href="https://github.com/openai/openai-cookbook/blob/main/examples/Orchestrating_agents.ipynb" rel="nofollow noopener">OpenAI example<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a>.</p>
<p>Consider a customer service scenario where a customer is trying to get a refund for a product, or purchase a new product from a chatbot.
The chatbot is a multi-agent team consisting of three AI agents and one human agent:</p>
<ul class="simple">
<li><p>Triage Agent, responsible for understanding the customerâ€™s request and deciding which other agents to hand off to.</p></li>
<li><p>Refund Agent, responsible for processing refund requests.</p></li>
<li><p>Sales Agent, responsible for processing sales requests.</p></li>
<li><p>Human Agent, responsible for handling complex requests that the AI agents canâ€™t handle.</p></li>
</ul>
<p>In this scenario, the customer interacts with the chatbot through a User Agent.</p>
<p>The diagram below shows the interaction topology of the agents in this scenario.</p>
<p><img alt="Handoffs" src="../../../_images/handoffs.svg"/></p>
<p>Letâ€™s implement this scenario using AutoGen Core. First, we need to import the necessary modules.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="kn">import</span> <span class="nn">json</span>
</span><span id="line-2"><span class="kn">import</span> <span class="nn">uuid</span>
</span><span id="line-3"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>
</span><span id="line-4">
</span><span id="line-5"><span class="kn">from</span> <span class="nn">autogen_core.application</span> <span class="kn">import</span> <span class="n">SingleThreadedAgentRuntime</span>
</span><span id="line-6"><span class="kn">from</span> <span class="nn">autogen_core.base</span> <span class="kn">import</span> <span class="n">MessageContext</span><span class="p">,</span> <span class="n">TopicId</span>
</span><span id="line-7"><span class="kn">from</span> <span class="nn">autogen_core.components</span> <span class="kn">import</span> <span class="n">FunctionCall</span><span class="p">,</span> <span class="n">RoutedAgent</span><span class="p">,</span> <span class="n">TypeSubscription</span><span class="p">,</span> <span class="n">message_handler</span>
</span><span id="line-8"><span class="kn">from</span> <span class="nn">autogen_core.components.models</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="line-9">    <span class="n">AssistantMessage</span><span class="p">,</span>
</span><span id="line-10">    <span class="n">ChatCompletionClient</span><span class="p">,</span>
</span><span id="line-11">    <span class="n">FunctionExecutionResult</span><span class="p">,</span>
</span><span id="line-12">    <span class="n">FunctionExecutionResultMessage</span><span class="p">,</span>
</span><span id="line-13">    <span class="n">LLMMessage</span><span class="p">,</span>
</span><span id="line-14">    <span class="n">SystemMessage</span><span class="p">,</span>
</span><span id="line-15">    <span class="n">UserMessage</span><span class="p">,</span>
</span><span id="line-16"><span class="p">)</span>
</span><span id="line-17"><span class="kn">from</span> <span class="nn">autogen_core.components.tools</span> <span class="kn">import</span> <span class="n">FunctionTool</span><span class="p">,</span> <span class="n">Tool</span>
</span><span id="line-18"><span class="kn">from</span> <span class="nn">autogen_ext.models</span> <span class="kn">import</span> <span class="n">OpenAIChatCompletionClient</span>
</span><span id="line-19"><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="message-protocol">
<h2>Message Protocol<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#message-protocol" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#message-protocol'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Before everything, we need to define the message protocol for the agents to communicate.
We are using event-driven pub-sub communication, so these message types will be used as events.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">UserLogin</span></code> is a message published by the runtime when a user logs in and starts a new session.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UserTask</span></code> is a message containing the chat history of the user session. When an AI agent hands off a task to other agents, it also publishes a <code class="docutils literal notranslate"><span class="pre">UserTask</span></code> message.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">AgentResponse</span></code> is a message published by the AI agents and the Human Agent, it also contains the chat history as well as a topic type for the customer to reply to.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">class</span> <span class="nc">UserLogin</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="line-2">    <span class="k">pass</span>
</span><span id="line-3">
</span><span id="line-4">
</span><span id="line-5"><span class="k">class</span> <span class="nc">UserTask</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="line-6">    <span class="n">context</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LLMMessage</span><span class="p">]</span>
</span><span id="line-7">
</span><span id="line-8">
</span><span id="line-9"><span class="k">class</span> <span class="nc">AgentResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="line-10">    <span class="n">reply_to_topic_type</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="line-11">    <span class="n">context</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">LLMMessage</span><span class="p">]</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="ai-agent">
<h2>AI Agent<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#ai-agent" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#ai-agent'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>We start with the <code class="docutils literal notranslate"><span class="pre">AIAgent</span></code> class, which is the class for all AI agents
(i.e., Triage, Sales, and Issue and Repair Agents) in the multi-agent chatbot.
An <code class="docutils literal notranslate"><span class="pre">AIAgent</span></code> uses a <a class="reference internal" href="../../../reference/python/autogen_core/autogen_core.components.models.html#autogen_core.components.models.ChatCompletionClient" title="autogen_core.components.models.ChatCompletionClient"><code class="xref py py-class docutils literal notranslate"><span class="pre">ChatCompletionClient</span></code></a>
to generate responses.
It can use regular tools directly or delegate tasks to other agents using <code class="docutils literal notranslate"><span class="pre">delegate_tools</span></code>.
It subscribes to topic type <code class="docutils literal notranslate"><span class="pre">agent_topic_type</span></code> to receive messages from the customer,
and sends message to the customer by publishing to the topic type <code class="docutils literal notranslate"><span class="pre">user_topic_type</span></code>.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">handle_task</span></code> method, the agent first generates a response using the model.
If the response contains a handoff tool call, the agent delegates the task to another agent
by publishing a <code class="docutils literal notranslate"><span class="pre">UserTask</span></code> message to the topic specified in the tool call result.
If the response is a regular tool call, the agent executes the tool and makes
another call to the model to generate the next response, until the response is not a tool call.</p>
<p>When the model response is not a tool call, the agent sends an <code class="docutils literal notranslate"><span class="pre">AgentResponse</span></code> message to the customer
by publishing to the <code class="docutils literal notranslate"><span class="pre">user_topic_type</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">class</span> <span class="nc">AIAgent</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
</span><span id="line-2">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="line-3">        <span class="bp">self</span><span class="p">,</span>
</span><span id="line-4">        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-5">        <span class="n">system_message</span><span class="p">:</span> <span class="n">SystemMessage</span><span class="p">,</span>
</span><span id="line-6">        <span class="n">model_client</span><span class="p">:</span> <span class="n">ChatCompletionClient</span><span class="p">,</span>
</span><span id="line-7">        <span class="n">tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">],</span>
</span><span id="line-8">        <span class="n">delegate_tools</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tool</span><span class="p">],</span>
</span><span id="line-9">        <span class="n">agent_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-10">        <span class="n">user_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="line-11">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-12">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="line-13">        <span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span> <span class="o">=</span> <span class="n">system_message</span>
</span><span id="line-14">        <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span> <span class="o">=</span> <span class="n">model_client</span>
</span><span id="line-15">        <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">])</span>
</span><span id="line-16">        <span class="bp">self</span><span class="o">.</span><span class="n">_tool_schema</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">schema</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">]</span>
</span><span id="line-17">        <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tools</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tool</span><span class="p">)</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">delegate_tools</span><span class="p">])</span>
</span><span id="line-18">        <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tool_schema</span> <span class="o">=</span> <span class="p">[</span><span class="n">tool</span><span class="o">.</span><span class="n">schema</span> <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">delegate_tools</span><span class="p">]</span>
</span><span id="line-19">        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span> <span class="o">=</span> <span class="n">agent_topic_type</span>
</span><span id="line-20">        <span class="bp">self</span><span class="o">.</span><span class="n">_user_topic_type</span> <span class="o">=</span> <span class="n">user_topic_type</span>
</span><span id="line-21">
</span><span id="line-22">    <span class="nd">@message_handler</span>
</span><span id="line-23">    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">UserTask</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-24">        <span class="c1"># Send the task to the LLM.</span>
</span><span id="line-25">        <span class="n">llm_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="line-26">            <span class="n">messages</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span><span class="p">]</span> <span class="o">+</span> <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
</span><span id="line-27">            <span class="n">tools</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tool_schema</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tool_schema</span><span class="p">,</span>
</span><span id="line-28">            <span class="n">cancellation_token</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">,</span>
</span><span id="line-29">        <span class="p">)</span>
</span><span id="line-30">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-31">        <span class="c1"># Process the LLM result.</span>
</span><span id="line-32">        <span class="k">while</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">FunctionCall</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="line-33">            <span class="n">tool_call_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">FunctionExecutionResult</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-34">            <span class="n">delegate_targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">UserTask</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="line-35">            <span class="c1"># Process each function call.</span>
</span><span id="line-36">            <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="line-37">                <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="line-38">                <span class="k">if</span> <span class="n">call</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">:</span>
</span><span id="line-39">                    <span class="c1"># Execute the tool directly.</span>
</span><span id="line-40">                    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">run_json</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">)</span>
</span><span id="line-41">                    <span class="n">result_as_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tools</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">return_value_as_string</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="line-42">                    <span class="n">tool_call_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FunctionExecutionResult</span><span class="p">(</span><span class="n">call_id</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="n">result_as_str</span><span class="p">))</span>
</span><span id="line-43">                <span class="k">elif</span> <span class="n">call</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tools</span><span class="p">:</span>
</span><span id="line-44">                    <span class="c1"># Execute the tool to get the delegate agent's topic type.</span>
</span><span id="line-45">                    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tools</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">run_json</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">)</span>
</span><span id="line-46">                    <span class="n">topic_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tools</span><span class="p">[</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">return_value_as_string</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="line-47">                    <span class="c1"># Create the context for the delegate agent, including the function call and the result.</span>
</span><span id="line-48">                    <span class="n">delegate_messages</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="line-49">                        <span class="n">AssistantMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="p">[</span><span class="n">call</span><span class="p">],</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
</span><span id="line-50">                        <span class="n">FunctionExecutionResultMessage</span><span class="p">(</span>
</span><span id="line-51">                            <span class="n">content</span><span class="o">=</span><span class="p">[</span>
</span><span id="line-52">                                <span class="n">FunctionExecutionResult</span><span class="p">(</span>
</span><span id="line-53">                                    <span class="n">call_id</span><span class="o">=</span><span class="n">call</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">"Transfered to </span><span class="si">{</span><span class="n">topic_type</span><span class="si">}</span><span class="s2">. Adopt persona immediately."</span>
</span><span id="line-54">                                <span class="p">)</span>
</span><span id="line-55">                            <span class="p">]</span>
</span><span id="line-56">                        <span class="p">),</span>
</span><span id="line-57">                    <span class="p">]</span>
</span><span id="line-58">                    <span class="n">delegate_targets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">topic_type</span><span class="p">,</span> <span class="n">UserTask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">delegate_messages</span><span class="p">)))</span>
</span><span id="line-59">                <span class="k">else</span><span class="p">:</span>
</span><span id="line-60">                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Unknown tool: </span><span class="si">{</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-61">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">delegate_targets</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="line-62">                <span class="c1"># Delegate the task to other agents by publishing messages to the corresponding topics.</span>
</span><span id="line-63">                <span class="k">for</span> <span class="n">topic_type</span><span class="p">,</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">delegate_targets</span><span class="p">:</span>
</span><span id="line-64">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">Delegating to </span><span class="si">{</span><span class="n">topic_type</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-65">                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="n">topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="p">))</span>
</span><span id="line-66">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_call_results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="line-67">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">tool_call_results</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-68">                <span class="c1"># Make another LLM call with the results.</span>
</span><span id="line-69">                <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
</span><span id="line-70">                    <span class="p">[</span>
</span><span id="line-71">                        <span class="n">AssistantMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">),</span>
</span><span id="line-72">                        <span class="n">FunctionExecutionResultMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">tool_call_results</span><span class="p">),</span>
</span><span id="line-73">                    <span class="p">]</span>
</span><span id="line-74">                <span class="p">)</span>
</span><span id="line-75">                <span class="n">llm_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
</span><span id="line-76">                    <span class="n">messages</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_system_message</span><span class="p">]</span> <span class="o">+</span> <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
</span><span id="line-77">                    <span class="n">tools</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_tool_schema</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_delegate_tool_schema</span><span class="p">,</span>
</span><span id="line-78">                    <span class="n">cancellation_token</span><span class="o">=</span><span class="n">ctx</span><span class="o">.</span><span class="n">cancellation_token</span><span class="p">,</span>
</span><span id="line-79">                <span class="p">)</span>
</span><span id="line-80">                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-81">            <span class="k">else</span><span class="p">:</span>
</span><span id="line-82">                <span class="c1"># The task has been delegated, so we are done.</span>
</span><span id="line-83">                <span class="k">return</span>
</span><span id="line-84">        <span class="c1"># The task has been completed, publish the final result.</span>
</span><span id="line-85">        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="line-86">        <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">llm_result</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span><span id="line-87">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
</span><span id="line-88">            <span class="n">AgentResponse</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">reply_to_topic_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span><span class="p">),</span>
</span><span id="line-89">            <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="p">),</span>
</span><span id="line-90">        <span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="human-agent">
<h2>Human Agent<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#human-agent" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#human-agent'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">HumanAgent</span></code> class is a proxy for the human in the chatbot. It is used
to handle requests that the AI agents canâ€™t handle. The <code class="docutils literal notranslate"><span class="pre">HumanAgent</span></code> subscribes to the
topic type <code class="docutils literal notranslate"><span class="pre">agent_topic_type</span></code> to receive messages and publishes to the topic type <code class="docutils literal notranslate"><span class="pre">user_topic_type</span></code>
to send messages to the customer.</p>
<p>In this implementation, the <code class="docutils literal notranslate"><span class="pre">HumanAgent</span></code> simply uses console to
get your input. In a real-world application, you can improve this design as follows:</p>
<ul class="simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">handle_user_task</span></code> method, send a notification via a chat application like Teams or Slack.</p></li>
<li><p>The chat application publishes the humanâ€™s response via the runtime to the topic specified by <code class="docutils literal notranslate"><span class="pre">agent_topic_type</span></code></p></li>
<li><p>Create another message handler to process the humanâ€™s response and send it back to the customer.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">class</span> <span class="nc">HumanAgent</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
</span><span id="line-2">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-3">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="line-4">        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span> <span class="o">=</span> <span class="n">agent_topic_type</span>
</span><span id="line-5">        <span class="bp">self</span><span class="o">.</span><span class="n">_user_topic_type</span> <span class="o">=</span> <span class="n">user_topic_type</span>
</span><span id="line-6">
</span><span id="line-7">    <span class="nd">@message_handler</span>
</span><span id="line-8">    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_user_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">UserTask</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-9">        <span class="n">human_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Human agent input: "</span><span class="p">)</span>
</span><span id="line-10">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">human_input</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-11">        <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AssistantMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">human_input</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span><span id="line-12">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
</span><span id="line-13">            <span class="n">AgentResponse</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">reply_to_topic_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span><span class="p">),</span>
</span><span id="line-14">            <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="p">),</span>
</span><span id="line-15">        <span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="user-agent">
<h2>User Agent<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#user-agent" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#user-agent'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> class is a proxy for the customer that talks to the chatbot.
It handles two message types: <code class="docutils literal notranslate"><span class="pre">UserLogin</span></code> and <code class="docutils literal notranslate"><span class="pre">AgentResponse</span></code>.
When the <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> receives a <code class="docutils literal notranslate"><span class="pre">UserLogin</span></code> message, it starts a new session with the chatbot
and publishes a <code class="docutils literal notranslate"><span class="pre">UserTask</span></code> message to the AI agent that subscribes to the topic type <code class="docutils literal notranslate"><span class="pre">agent_topic_type</span></code>.
When the <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> receives an <code class="docutils literal notranslate"><span class="pre">AgentResponse</span></code> message, it prompts the user with the response
from the chatbot.</p>
<p>In this implementation, the <code class="docutils literal notranslate"><span class="pre">UserAgent</span></code> uses console to get your input.
In a real-world application, you can improve the human interaction using the same
idea described in the <code class="docutils literal notranslate"><span class="pre">HumanAgent</span></code> section above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">class</span> <span class="nc">UserAgent</span><span class="p">(</span><span class="n">RoutedAgent</span><span class="p">):</span>
</span><span id="line-2">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">agent_topic_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-3">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>
</span><span id="line-4">        <span class="bp">self</span><span class="o">.</span><span class="n">_user_topic_type</span> <span class="o">=</span> <span class="n">user_topic_type</span>
</span><span id="line-5">        <span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span> <span class="o">=</span> <span class="n">agent_topic_type</span>
</span><span id="line-6">
</span><span id="line-7">    <span class="nd">@message_handler</span>
</span><span id="line-8">    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_user_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">UserLogin</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-9">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="s2">User login, session ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">."</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-10">        <span class="c1"># Get the user's initial input after login.</span>
</span><span id="line-11">        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"User: "</span><span class="p">)</span>
</span><span id="line-12">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-13">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
</span><span id="line-14">            <span class="n">UserTask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">[</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">user_input</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">"User"</span><span class="p">)]),</span>
</span><span id="line-15">            <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_agent_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="p">),</span>
</span><span id="line-16">        <span class="p">)</span>
</span><span id="line-17">
</span><span id="line-18">    <span class="nd">@message_handler</span>
</span><span id="line-19">    <span class="k">async</span> <span class="k">def</span> <span class="nf">handle_task_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">AgentResponse</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">MessageContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="line-20">        <span class="c1"># Get the user's input after receiving a response from an agent.</span>
</span><span id="line-21">        <span class="n">user_input</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"User (type 'exit' to close the session): "</span><span class="p">)</span>
</span><span id="line-22">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">user_input</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="line-23">        <span class="k">if</span> <span class="n">user_input</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">"exit"</span><span class="p">:</span>
</span><span id="line-24">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="o">*</span><span class="mi">80</span><span class="si">}</span><span class="se">\n</span><span class="s2">User session ended, session ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</span><span id="line-25">            <span class="k">return</span>
</span><span id="line-26">        <span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UserMessage</span><span class="p">(</span><span class="n">content</span><span class="o">=</span><span class="n">user_input</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s2">"User"</span><span class="p">))</span>
</span><span id="line-27">        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span>
</span><span id="line-28">            <span class="n">UserTask</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">context</span><span class="p">),</span> <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">reply_to_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
</span><span id="line-29">        <span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="tools-for-the-ai-agents">
<h2>Tools for the AI agents<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#tools-for-the-ai-agents" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#tools-for-the-ai-agents'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The AI agents can use regular tools to complete tasks if they donâ€™t need to hand off the task to other agents.
We define the tools using simple functions and create the tools using the
<a class="reference internal" href="../../../reference/python/autogen_core/autogen_core.components.tools.html#autogen_core.components.tools.FunctionTool" title="autogen_core.components.tools.FunctionTool"><code class="xref py py-class docutils literal notranslate"><span class="pre">FunctionTool</span></code></a> wrapper.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">def</span> <span class="nf">execute_order</span><span class="p">(</span><span class="n">product</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-2">    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">=== Order Summary ==="</span><span class="p">)</span>
</span><span id="line-3">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Product: </span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-4">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Price: $</span><span class="si">{</span><span class="n">price</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-5">    <span class="nb">print</span><span class="p">(</span><span class="s2">"=================</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-6">    <span class="n">confirm</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">"Confirm order? y/n: "</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="line-7">    <span class="k">if</span> <span class="n">confirm</span> <span class="o">==</span> <span class="s2">"y"</span><span class="p">:</span>
</span><span id="line-8">        <span class="nb">print</span><span class="p">(</span><span class="s2">"Order execution successful!"</span><span class="p">)</span>
</span><span id="line-9">        <span class="k">return</span> <span class="s2">"Success"</span>
</span><span id="line-10">    <span class="k">else</span><span class="p">:</span>
</span><span id="line-11">        <span class="nb">print</span><span class="p">(</span><span class="s2">"Order cancelled!"</span><span class="p">)</span>
</span><span id="line-12">        <span class="k">return</span> <span class="s2">"User cancelled order."</span>
</span><span id="line-13">
</span><span id="line-14">
</span><span id="line-15"><span class="k">def</span> <span class="nf">look_up_item</span><span class="p">(</span><span class="n">search_query</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-16">    <span class="n">item_id</span> <span class="o">=</span> <span class="s2">"item_132612938"</span>
</span><span id="line-17">    <span class="nb">print</span><span class="p">(</span><span class="s2">"Found item:"</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
</span><span id="line-18">    <span class="k">return</span> <span class="n">item_id</span>
</span><span id="line-19">
</span><span id="line-20">
</span><span id="line-21"><span class="k">def</span> <span class="nf">execute_refund</span><span class="p">(</span><span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"not provided"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-22">    <span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">=== Refund Summary ==="</span><span class="p">)</span>
</span><span id="line-23">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Item ID: </span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-24">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Reason: </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-25">    <span class="nb">print</span><span class="p">(</span><span class="s2">"=================</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
</span><span id="line-26">    <span class="nb">print</span><span class="p">(</span><span class="s2">"Refund execution successful!"</span><span class="p">)</span>
</span><span id="line-27">    <span class="k">return</span> <span class="s2">"success"</span>
</span><span id="line-28">
</span><span id="line-29">
</span><span id="line-30"><span class="n">execute_order_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">execute_order</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Price should be in USD."</span><span class="p">)</span>
</span><span id="line-31"><span class="n">look_up_item_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span>
</span><span id="line-32">    <span class="n">look_up_item</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Use to find item ID.</span><span class="se">\n</span><span class="s2">Search query can be a description or keywords."</span>
</span><span id="line-33"><span class="p">)</span>
</span><span id="line-34"><span class="n">execute_refund_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">execute_refund</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">""</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="topic-types-for-the-agents">
<h2>Topic types for the agents<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#topic-types-for-the-agents" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#topic-types-for-the-agents'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>We define the topic types each of the agents will subscribe to.
Read more about topic types in the <a class="reference internal" href="../core-concepts/topic-and-subscription.html"><span class="std std-doc">Topics and Subscriptions</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">sales_agent_topic_type</span> <span class="o">=</span> <span class="s2">"SalesAgent"</span>
</span><span id="line-2"><span class="n">issues_and_repairs_agent_topic_type</span> <span class="o">=</span> <span class="s2">"IssuesAndRepairsAgent"</span>
</span><span id="line-3"><span class="n">triage_agent_topic_type</span> <span class="o">=</span> <span class="s2">"TriageAgent"</span>
</span><span id="line-4"><span class="n">human_agent_topic_type</span> <span class="o">=</span> <span class="s2">"HumanAgent"</span>
</span><span id="line-5"><span class="n">user_topic_type</span> <span class="o">=</span> <span class="s2">"User"</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="delegate-tools-for-the-ai-agents">
<h2>Delegate tools for the AI agents<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#delegate-tools-for-the-ai-agents" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#delegate-tools-for-the-ai-agents'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Besides regular tools, the AI agents can delegate tasks to other agents using
special tools called delegate tools. The concept of delegate tool is only used
in this design pattern, and the delegate tools are also defined as simple functions.
We differentiate the delegate tools from regular tools in this design pattern
because when an AI agent calls a delegate tool, we transfer the task to another agent
instead of continue generating responses using the model in the same agent.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="k">def</span> <span class="nf">transfer_to_sales_agent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-2">    <span class="k">return</span> <span class="n">sales_agent_topic_type</span>
</span><span id="line-3">
</span><span id="line-4">
</span><span id="line-5"><span class="k">def</span> <span class="nf">transfer_to_issues_and_repairs</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-6">    <span class="k">return</span> <span class="n">issues_and_repairs_agent_topic_type</span>
</span><span id="line-7">
</span><span id="line-8">
</span><span id="line-9"><span class="k">def</span> <span class="nf">transfer_back_to_triage</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-10">    <span class="k">return</span> <span class="n">triage_agent_topic_type</span>
</span><span id="line-11">
</span><span id="line-12">
</span><span id="line-13"><span class="k">def</span> <span class="nf">escalate_to_human</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="line-14">    <span class="k">return</span> <span class="n">human_agent_topic_type</span>
</span><span id="line-15">
</span><span id="line-16">
</span><span id="line-17"><span class="n">transfer_to_sales_agent_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span>
</span><span id="line-18">    <span class="n">transfer_to_sales_agent</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Use for anything sales or buying related."</span>
</span><span id="line-19"><span class="p">)</span>
</span><span id="line-20"><span class="n">transfer_to_issues_and_repairs_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span>
</span><span id="line-21">    <span class="n">transfer_to_issues_and_repairs</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Use for issues, repairs, or refunds."</span>
</span><span id="line-22"><span class="p">)</span>
</span><span id="line-23"><span class="n">transfer_back_to_triage_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span>
</span><span id="line-24">    <span class="n">transfer_back_to_triage</span><span class="p">,</span>
</span><span id="line-25">    <span class="n">description</span><span class="o">=</span><span class="s2">"Call this if the user brings up a topic outside of your purview,</span><span class="se">\n</span><span class="s2">including escalating to human."</span><span class="p">,</span>
</span><span id="line-26"><span class="p">)</span>
</span><span id="line-27"><span class="n">escalate_to_human_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">escalate_to_human</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Only call this if explicitly asked to."</span><span class="p">)</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="creating-the-team">
<h2>Creating the team<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#creating-the-team" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#creating-the-team'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>We have defined the AI agents, the Human Agent, the User Agent, the tools, and the topic types.
Now we can create the team of agents.</p>
<p>For the AI agents, we use the {py:class}~autogen_ext.models.OpenAIChatCompletionClient<code class="docutils literal notranslate"><span class="pre">and</span></code>gpt-4o-mini` model.</p>
<p>After creating the agent runtime, we register each of the agent by providing
an agent type and a factory method to create agent instance.
The runtime is responsible for managing the agent lifecycle so we donâ€™t need to
instantiate the agents ourselves.
Read more about agent runtime in <a class="reference internal" href="../core-concepts/architecture.html"><span class="std std-doc">Agent Runtime Environments</span></a>
and agent lifecycle in <a class="reference internal" href="../core-concepts/agent-identity-and-lifecycle.html"><span class="std std-doc">Agent Identity and Lifecycle</span></a>.</p>
<p>In the code below, you can see we are using <code class="docutils literal notranslate"><span class="pre">AIAgent</span></code> class to define the Triage, Sales, and Issue and Repair Agents.
We added regular tools and delegate tools to each of them.
We also added subscriptions to the topic types for each of the agents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="n">runtime</span> <span class="o">=</span> <span class="n">SingleThreadedAgentRuntime</span><span class="p">()</span>
</span><span id="line-2">
</span><span id="line-3"><span class="n">model_client</span> <span class="o">=</span> <span class="n">OpenAIChatCompletionClient</span><span class="p">(</span>
</span><span id="line-4">    <span class="n">model</span><span class="o">=</span><span class="s2">"gpt-4o-mini"</span><span class="p">,</span>
</span><span id="line-5">    <span class="c1"># api_key="YOUR_API_KEY",</span>
</span><span id="line-6"><span class="p">)</span>
</span><span id="line-7">
</span><span id="line-8"><span class="c1"># Register the triage agent.</span>
</span><span id="line-9"><span class="n">triage_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AIAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
</span><span id="line-10">    <span class="n">runtime</span><span class="p">,</span>
</span><span id="line-11">    <span class="nb">type</span><span class="o">=</span><span class="n">triage_agent_topic_type</span><span class="p">,</span>  <span class="c1"># Using the topic type as the agent type.</span>
</span><span id="line-12">    <span class="n">factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">AIAgent</span><span class="p">(</span>
</span><span id="line-13">        <span class="n">description</span><span class="o">=</span><span class="s2">"A triage agent."</span><span class="p">,</span>
</span><span id="line-14">        <span class="n">system_message</span><span class="o">=</span><span class="n">SystemMessage</span><span class="p">(</span>
</span><span id="line-15">            <span class="n">content</span><span class="o">=</span><span class="s2">"You are a customer service bot for ACME Inc. "</span>
</span><span id="line-16">            <span class="s2">"Introduce yourself. Always be very brief. "</span>
</span><span id="line-17">            <span class="s2">"Gather information to direct the customer to the right department. "</span>
</span><span id="line-18">            <span class="s2">"But make your questions subtle and natural."</span>
</span><span id="line-19">        <span class="p">),</span>
</span><span id="line-20">        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
</span><span id="line-21">        <span class="n">tools</span><span class="o">=</span><span class="p">[],</span>
</span><span id="line-22">        <span class="n">delegate_tools</span><span class="o">=</span><span class="p">[</span>
</span><span id="line-23">            <span class="n">transfer_to_issues_and_repairs_tool</span><span class="p">,</span>
</span><span id="line-24">            <span class="n">transfer_to_sales_agent_tool</span><span class="p">,</span>
</span><span id="line-25">            <span class="n">escalate_to_human_tool</span><span class="p">,</span>
</span><span id="line-26">        <span class="p">],</span>
</span><span id="line-27">        <span class="n">agent_topic_type</span><span class="o">=</span><span class="n">triage_agent_topic_type</span><span class="p">,</span>
</span><span id="line-28">        <span class="n">user_topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-29">    <span class="p">),</span>
</span><span id="line-30"><span class="p">)</span>
</span><span id="line-31"><span class="c1"># Add subscriptions for the triage agent: it will receive messages published to its own topic only.</span>
</span><span id="line-32"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">triage_agent_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">triage_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span><span id="line-33">
</span><span id="line-34"><span class="c1"># Register the sales agent.</span>
</span><span id="line-35"><span class="n">sales_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AIAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
</span><span id="line-36">    <span class="n">runtime</span><span class="p">,</span>
</span><span id="line-37">    <span class="nb">type</span><span class="o">=</span><span class="n">sales_agent_topic_type</span><span class="p">,</span>  <span class="c1"># Using the topic type as the agent type.</span>
</span><span id="line-38">    <span class="n">factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">AIAgent</span><span class="p">(</span>
</span><span id="line-39">        <span class="n">description</span><span class="o">=</span><span class="s2">"A sales agent."</span><span class="p">,</span>
</span><span id="line-40">        <span class="n">system_message</span><span class="o">=</span><span class="n">SystemMessage</span><span class="p">(</span>
</span><span id="line-41">            <span class="n">content</span><span class="o">=</span><span class="s2">"You are a sales agent for ACME Inc."</span>
</span><span id="line-42">            <span class="s2">"Always answer in a sentence or less."</span>
</span><span id="line-43">            <span class="s2">"Follow the following routine with the user:"</span>
</span><span id="line-44">            <span class="s2">"1. Ask them about any problems in their life related to catching roadrunners.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-45">            <span class="s2">"2. Casually mention one of ACME's crazy made-up products can help.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-46">            <span class="s2">" - Don't mention price.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-47">            <span class="s2">"3. Once the user is bought in, drop a ridiculous price.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-48">            <span class="s2">"4. Only after everything, and if the user says yes, "</span>
</span><span id="line-49">            <span class="s2">"tell them a crazy caveat and execute their order.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-50">            <span class="s2">""</span>
</span><span id="line-51">        <span class="p">),</span>
</span><span id="line-52">        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
</span><span id="line-53">        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">execute_order_tool</span><span class="p">],</span>
</span><span id="line-54">        <span class="n">delegate_tools</span><span class="o">=</span><span class="p">[</span><span class="n">transfer_back_to_triage_tool</span><span class="p">],</span>
</span><span id="line-55">        <span class="n">agent_topic_type</span><span class="o">=</span><span class="n">sales_agent_topic_type</span><span class="p">,</span>
</span><span id="line-56">        <span class="n">user_topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-57">    <span class="p">),</span>
</span><span id="line-58"><span class="p">)</span>
</span><span id="line-59"><span class="c1"># Add subscriptions for the sales agent: it will receive messages published to its own topic only.</span>
</span><span id="line-60"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">sales_agent_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">sales_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span><span id="line-61">
</span><span id="line-62"><span class="c1"># Register the issues and repairs agent.</span>
</span><span id="line-63"><span class="n">issues_and_repairs_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">AIAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
</span><span id="line-64">    <span class="n">runtime</span><span class="p">,</span>
</span><span id="line-65">    <span class="nb">type</span><span class="o">=</span><span class="n">issues_and_repairs_agent_topic_type</span><span class="p">,</span>  <span class="c1"># Using the topic type as the agent type.</span>
</span><span id="line-66">    <span class="n">factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">AIAgent</span><span class="p">(</span>
</span><span id="line-67">        <span class="n">description</span><span class="o">=</span><span class="s2">"An issues and repairs agent."</span><span class="p">,</span>
</span><span id="line-68">        <span class="n">system_message</span><span class="o">=</span><span class="n">SystemMessage</span><span class="p">(</span>
</span><span id="line-69">            <span class="n">content</span><span class="o">=</span><span class="s2">"You are a customer support agent for ACME Inc."</span>
</span><span id="line-70">            <span class="s2">"Always answer in a sentence or less."</span>
</span><span id="line-71">            <span class="s2">"Follow the following routine with the user:"</span>
</span><span id="line-72">            <span class="s2">"1. First, ask probing questions and understand the user's problem deeper.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-73">            <span class="s2">" - unless the user has already provided a reason.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-74">            <span class="s2">"2. Propose a fix (make one up).</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-75">            <span class="s2">"3. ONLY if not satesfied, offer a refund.</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="line-76">            <span class="s2">"4. If accepted, search for the ID and then execute refund."</span>
</span><span id="line-77">        <span class="p">),</span>
</span><span id="line-78">        <span class="n">model_client</span><span class="o">=</span><span class="n">model_client</span><span class="p">,</span>
</span><span id="line-79">        <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
</span><span id="line-80">            <span class="n">execute_refund_tool</span><span class="p">,</span>
</span><span id="line-81">            <span class="n">look_up_item_tool</span><span class="p">,</span>
</span><span id="line-82">        <span class="p">],</span>
</span><span id="line-83">        <span class="n">delegate_tools</span><span class="o">=</span><span class="p">[</span><span class="n">transfer_back_to_triage_tool</span><span class="p">],</span>
</span><span id="line-84">        <span class="n">agent_topic_type</span><span class="o">=</span><span class="n">issues_and_repairs_agent_topic_type</span><span class="p">,</span>
</span><span id="line-85">        <span class="n">user_topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-86">    <span class="p">),</span>
</span><span id="line-87"><span class="p">)</span>
</span><span id="line-88"><span class="c1"># Add subscriptions for the issues and repairs agent: it will receive messages published to its own topic only.</span>
</span><span id="line-89"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span>
</span><span id="line-90">    <span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">issues_and_repairs_agent_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">issues_and_repairs_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
</span><span id="line-91"><span class="p">)</span>
</span><span id="line-92">
</span><span id="line-93"><span class="c1"># Register the human agent.</span>
</span><span id="line-94"><span class="n">human_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">HumanAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
</span><span id="line-95">    <span class="n">runtime</span><span class="p">,</span>
</span><span id="line-96">    <span class="nb">type</span><span class="o">=</span><span class="n">human_agent_topic_type</span><span class="p">,</span>  <span class="c1"># Using the topic type as the agent type.</span>
</span><span id="line-97">    <span class="n">factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">HumanAgent</span><span class="p">(</span>
</span><span id="line-98">        <span class="n">description</span><span class="o">=</span><span class="s2">"A human agent."</span><span class="p">,</span>
</span><span id="line-99">        <span class="n">agent_topic_type</span><span class="o">=</span><span class="n">human_agent_topic_type</span><span class="p">,</span>
</span><span id="line-100">        <span class="n">user_topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-101">    <span class="p">),</span>
</span><span id="line-102"><span class="p">)</span>
</span><span id="line-103"><span class="c1"># Add subscriptions for the human agent: it will receive messages published to its own topic only.</span>
</span><span id="line-104"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">human_agent_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">human_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span><span id="line-105">
</span><span id="line-106"><span class="c1"># Register the user agent.</span>
</span><span id="line-107"><span class="n">user_agent_type</span> <span class="o">=</span> <span class="k">await</span> <span class="n">UserAgent</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
</span><span id="line-108">    <span class="n">runtime</span><span class="p">,</span>
</span><span id="line-109">    <span class="nb">type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-110">    <span class="n">factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">UserAgent</span><span class="p">(</span>
</span><span id="line-111">        <span class="n">description</span><span class="o">=</span><span class="s2">"A user agent."</span><span class="p">,</span>
</span><span id="line-112">        <span class="n">user_topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span>
</span><span id="line-113">        <span class="n">agent_topic_type</span><span class="o">=</span><span class="n">triage_agent_topic_type</span><span class="p">,</span>  <span class="c1"># Start with the triage agent.</span>
</span><span id="line-114">    <span class="p">),</span>
</span><span id="line-115"><span class="p">)</span>
</span><span id="line-116"><span class="c1"># Add subscriptions for the user agent: it will receive messages published to its own topic only.</span>
</span><span id="line-117"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">add_subscription</span><span class="p">(</span><span class="n">TypeSubscription</span><span class="p">(</span><span class="n">topic_type</span><span class="o">=</span><span class="n">user_topic_type</span><span class="p">,</span> <span class="n">agent_type</span><span class="o">=</span><span class="n">user_agent_type</span><span class="o">.</span><span class="n">type</span><span class="p">))</span>
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="running-the-team">
<h2>Running the team<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#running-the-team" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#running-the-team'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Finally, we can start the runtime and simulate a user session by publishing
a <code class="docutils literal notranslate"><span class="pre">UserLogin</span></code> message to the runtime.
The message is published to the topic ID with type set to <code class="docutils literal notranslate"><span class="pre">user_topic_type</span></code>
and source set to a unique <code class="docutils literal notranslate"><span class="pre">session_id</span></code>.
This <code class="docutils literal notranslate"><span class="pre">session_id</span></code> will be used to create all topic IDs in this user session and will also be used to create the agent ID
for all the agents in this user session.
To read more about how topic ID and agent ID are created, read
<a class="reference internal" href="../core-concepts/agent-identity-and-lifecycle.html"><span class="std std-doc">Agent Identity and Lifecycle</span></a>.
and <a class="reference internal" href="../core-concepts/topic-and-subscription.html"><span class="std std-doc">Topics and Subscriptions</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="c1"># Start the runtime.</span>
</span><span id="line-2"><span class="n">runtime</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="line-3">
</span><span id="line-4"><span class="c1"># Create a new session for the user.</span>
</span><span id="line-5"><span class="n">session_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</span><span id="line-6"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">publish_message</span><span class="p">(</span><span class="n">UserLogin</span><span class="p">(),</span> <span class="n">topic_id</span><span class="o">=</span><span class="n">TopicId</span><span class="p">(</span><span class="n">user_topic_type</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">session_id</span><span class="p">))</span>
</span><span id="line-7">
</span><span id="line-8"><span class="c1"># Run until completion.</span>
</span><span id="line-9"><span class="k">await</span> <span class="n">runtime</span><span class="o">.</span><span class="n">stop_when_idle</span><span class="p">()</span>
</span></code></pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><code><span id="line-1">--------------------------------------------------------------------------------
</span><span id="line-2">User login, session ID: 7a568cf5-13e7-4e81-8616-8265a01b3f2b.
</span><span id="line-3">--------------------------------------------------------------------------------
</span><span id="line-4">User:
</span><span id="line-5">I want a refund
</span><span id="line-6">--------------------------------------------------------------------------------
</span><span id="line-7">TriageAgent:
</span><span id="line-8">I can help with that! Could I ask what item you're seeking a refund for?
</span><span id="line-9">--------------------------------------------------------------------------------
</span><span id="line-10">User:
</span><span id="line-11">A pair of shoes I bought
</span><span id="line-12">--------------------------------------------------------------------------------
</span><span id="line-13">TriageAgent:
</span><span id="line-14">[FunctionCall(id='call_qPx1DXDL2NLcHs8QNo47egsJ', arguments='{}', name='transfer_to_issues_and_repairs')]
</span><span id="line-15">--------------------------------------------------------------------------------
</span><span id="line-16">TriageAgent:
</span><span id="line-17">Delegating to IssuesAndRepairsAgent
</span><span id="line-18">--------------------------------------------------------------------------------
</span><span id="line-19">IssuesAndRepairsAgent:
</span><span id="line-20">I see you're looking for a refund on a pair of shoes. Can you tell me what the issue is with the shoes?
</span><span id="line-21">--------------------------------------------------------------------------------
</span><span id="line-22">User:
</span><span id="line-23">The shoes are too small
</span><span id="line-24">--------------------------------------------------------------------------------
</span><span id="line-25">IssuesAndRepairsAgent:
</span><span id="line-26">I recommend trying a size up as a fix; would that work for you?
</span><span id="line-27">--------------------------------------------------------------------------------
</span><span id="line-28">User:
</span><span id="line-29">no I want a refund
</span><span id="line-30">--------------------------------------------------------------------------------
</span><span id="line-31">IssuesAndRepairsAgent:
</span><span id="line-32">[FunctionCall(id='call_Ytp8VUQRyKFNEU36mLE6Dkrp', arguments='{"search_query":"shoes"}', name='look_up_item')]
</span><span id="line-33">--------------------------------------------------------------------------------
</span><span id="line-34">IssuesAndRepairsAgent:
</span><span id="line-35">[FunctionExecutionResult(content='item_132612938', call_id='call_Ytp8VUQRyKFNEU36mLE6Dkrp')]
</span><span id="line-36">--------------------------------------------------------------------------------
</span><span id="line-37">IssuesAndRepairsAgent:
</span><span id="line-38">[FunctionCall(id='call_bPm6EKKBy5GJ65s9OKt9b1uE', arguments='{"item_id":"item_132612938","reason":"not provided"}', name='execute_refund')]
</span><span id="line-39">--------------------------------------------------------------------------------
</span><span id="line-40">IssuesAndRepairsAgent:
</span><span id="line-41">[FunctionExecutionResult(content='success', call_id='call_bPm6EKKBy5GJ65s9OKt9b1uE')]
</span><span id="line-42">--------------------------------------------------------------------------------
</span><span id="line-43">IssuesAndRepairsAgent:
</span><span id="line-44">Your refund has been successfully processed! If you have any other questions, feel free to ask.
</span><span id="line-45">--------------------------------------------------------------------------------
</span><span id="line-46">User:
</span><span id="line-47">I want to talk to your manager
</span><span id="line-48">--------------------------------------------------------------------------------
</span><span id="line-49">IssuesAndRepairsAgent:
</span><span id="line-50">I can help with that, let me transfer you to a supervisor.
</span><span id="line-51">--------------------------------------------------------------------------------
</span><span id="line-52">User:
</span><span id="line-53">Okay
</span><span id="line-54">--------------------------------------------------------------------------------
</span><span id="line-55">IssuesAndRepairsAgent:
</span><span id="line-56">[FunctionCall(id='call_PpmLZvwNoiDPUH8Tva3eAwHX', arguments='{}', name='transfer_back_to_triage')]
</span><span id="line-57">--------------------------------------------------------------------------------
</span><span id="line-58">IssuesAndRepairsAgent:
</span><span id="line-59">Delegating to TriageAgent
</span><span id="line-60">--------------------------------------------------------------------------------
</span><span id="line-61">TriageAgent:
</span><span id="line-62">[FunctionCall(id='call_jSL6IBm5537Dr74UbJSxaj6I', arguments='{}', name='escalate_to_human')]
</span><span id="line-63">--------------------------------------------------------------------------------
</span><span id="line-64">TriageAgent:
</span><span id="line-65">Delegating to HumanAgent
</span><span id="line-66">--------------------------------------------------------------------------------
</span><span id="line-67">HumanAgent:
</span><span id="line-68">Hello this is manager
</span><span id="line-69">--------------------------------------------------------------------------------
</span><span id="line-70">User:
</span><span id="line-71">Hi! Thanks for your service. I give you a 5 start!
</span><span id="line-72">--------------------------------------------------------------------------------
</span><span id="line-73">HumanAgent:
</span><span id="line-74">Thanks.
</span><span id="line-75">--------------------------------------------------------------------------------
</span><span id="line-76">User:
</span><span id="line-77">exit
</span><span id="line-78">--------------------------------------------------------------------------------
</span><span id="line-79">User session ended, session ID: 7a568cf5-13e7-4e81-8616-8265a01b3f2b.
</span></code></pre></div>
</div>
</div>
</div>
</section>
<section id="next-steps">
<h2>Next steps<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#next-steps" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#next-steps'"><svg height="1em" viewbox="0 0 24 24" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>This notebook demonstrates how to implement the handoff pattern using AutoGen Core.
You can continue to improve this design by adding more agents and tools,
or create a better user interface for the User Agent and Human Agent.</p>
<p>You are welcome to share your work on our <a class="reference external" href="https://github.com/microsoft/autogen/discussions" rel="nofollow noopener">community forum<svg fill="currentColor" height="1em" stroke="none" viewbox="0 96 960 960" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M188 868q-11-11-11-28t11-28l436-436H400q-17 0-28.5-11.5T360 336q0-17 11.5-28.5T400 296h320q17 0 28.5 11.5T760 336v320q0 17-11.5 28.5T720 696q-17 0-28.5-11.5T680 656V432L244 868q-11 11-28 11t-28-11Z"></path></svg></a>.</p>
</section>
</section>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#scenario'" class="reference internal" href="#scenario">Scenario</a></li>
<li><a :data-current="activeSection === '#message-protocol'" class="reference internal" href="#message-protocol">Message Protocol</a></li>
<li><a :data-current="activeSection === '#ai-agent'" class="reference internal" href="#ai-agent">AI Agent</a></li>
<li><a :data-current="activeSection === '#human-agent'" class="reference internal" href="#human-agent">Human Agent</a></li>
<li><a :data-current="activeSection === '#user-agent'" class="reference internal" href="#user-agent">User Agent</a></li>
<li><a :data-current="activeSection === '#tools-for-the-ai-agents'" class="reference internal" href="#tools-for-the-ai-agents">Tools for the AI agents</a></li>
<li><a :data-current="activeSection === '#topic-types-for-the-agents'" class="reference internal" href="#topic-types-for-the-agents">Topic types for the agents</a></li>
<li><a :data-current="activeSection === '#delegate-tools-for-the-ai-agents'" class="reference internal" href="#delegate-tools-for-the-ai-agents">Delegate tools for the AI agents</a></li>
<li><a :data-current="activeSection === '#creating-the-team'" class="reference internal" href="#creating-the-team">Creating the team</a></li>
<li><a :data-current="activeSection === '#running-the-team'" class="reference internal" href="#running-the-team">Running the team</a></li>
<li><a :data-current="activeSection === '#next-steps'" class="reference internal" href="#next-steps">Next steps</a></li>
</ul>
<div class="show-on-github">
<a :data-current="activeSection === 'https://github.com/microsoft/autogen/blob/main/python/packages/autogen-core/docs/src/user-guide/core-user-guide/design-patterns/handoffs.ipynb'" class="text-sm leading-loose text-muted-foreground" href="https://github.com/microsoft/autogen/blob/main/python/packages/autogen-core/docs/src/user-guide/core-user-guide/design-patterns/handoffs.ipynb">
<span class="fa-brands fa-github"></span> Show on GitHub
            </a>
</div>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">Â© 2024, MicrosoftÂ . Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 8.1.3</a><ul class="list-unstyled text-sm leading-loose text-right text-muted-foreground md:text-right">
<li>  |  <a class="underline underline-offset-4" href="https://go.microsoft.com/fwlink/?LinkId=521839">Privacy Policy</a> | <a class="underline underline-offset-4" href="https://go.microsoft.com/fwlink/?linkid=2259814">Consumer Health Privacy</a> </li>
</ul></p>
</div>
</div>
</footer>
</div>
<script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../../../_static/doctools.js?v=9bcbadda"></script>
<script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="../../../_static/theme.js?v=073f68d9"></script>
<script src="../../../_static/design-tabs.js?v=f930bc37"></script>
<script></script>
</body>
</html>